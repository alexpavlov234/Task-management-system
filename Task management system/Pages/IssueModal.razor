@using Syncfusion.Blazor.Calendars
@using Syncfusion.Blazor.DropDowns
@using System.ComponentModel.DataAnnotations
@using Syncfusion.Blazor.Inputs
@using Task_management_system.Areas.Identity
@using Task_management_system.Models
@using Task_management_system.Pages.Common
@using Task_management_system.Services.Common
@using Syncfusion.Blazor.Popups
@inject IProjectService ProjectService


<SfDialog Width="85%" Height="auto" IsModal="true" ShowCloseIcon="true" EnableResize="true" AllowDragging="true" @bind-Visible="@IsVisible">
    <DialogTemplates>
        <Header>
            @if (this.issueProjectName != null && this.issueProjectName != "")
            {
                <span style="color: darkgray;">@this.issueProjectName / </span>

                <span style="color: #009cfc;">@this.issue.Subject</span>

            }
            else
            {
                <span style="color: #009cfc;">@this.issue.Subject</span>
            }
        </Header>
        <Content>


            
            <hr class="@statusLineColor"/>
            <EditForm EditContext="editContext">

                <DataAnnotationsValidator/>


                <InputText id="issueName" @bind-Value="issue.Subject" class="form-control my-4" placeholder="Име" style="font-size: 36px"></InputText>
                <ValidationMessage For="@(() => issue.Subject)"/>
                <div class="row">
                    <div class="col-md-6">
                        <div class="p-3 col-md-12" style="border: 1px solid lightgray; border-radius: 5px">
                            <div class="row py-1">
                                <div class="col-md-3 d-flex align-items-center">
                                    <i class="fa-solid fa-arrows-spin" style="color: dimgray"></i>&nbsp;&nbsp;<span style="color: dimgray;"><b>Статус</b></span> &nbsp;&nbsp;&nbsp;&nbsp;
                                </div>
                                <div class="col-md-9 d-flex align-items-center">

                                    <SfDropDownList @ref="statusDropDownList" ID="status" TValue="string" Enabled="true" TItem="KeyValue" @bind-Value="issue.Status" PopupHeight="350px" PopupWidth="350px" DataSource="@statuses">
                                        <DropDownListFieldSettings Value="Name" Text="Name"></DropDownListFieldSettings>
                                        <DropDownListEvents TItem="KeyValue" TValue="string" ValueChange="@OnValueSelectHandlerStatus"></DropDownListEvents>
                                    </SfDropDownList>

                                </div>

                                <div/>



                            </div>

                        </div>
                        <ValidationMessage For="@(() => issue.Status)"/>
                    </div>
                    <div class="col-md-6">
                        <div class="p-3 col-md-12" style="border: 1px solid lightgray; border-radius: 5px">
                            <div class="row py-1">
                                <div class="col-md-3 d-flex align-items-center">
                                    <i class="fa-solid fa-clone fa-lg" style="color: dimgray"></i>&nbsp;&nbsp;<span style="color: dimgray;"><b>Проект</b></span> &nbsp;&nbsp;&nbsp;&nbsp;
                                </div>
                                <div class="col-md-9 d-flex align-items-center">
                                    <SfDropDownList ID="project" TValue="string" TItem="Project" @bind-Value="issueProjectName" PopupHeight="350px" PopupWidth="350px" Placeholder="Изберете проект" DataSource="@projects">
                                        <DropDownListFieldSettings Value="ProjectName" Text="ProjectName"></DropDownListFieldSettings>
                                        <DropDownListEvents TItem="Project" TValue="string" ValueChange="@OnValueSelectHandlerProject"></DropDownListEvents>
                                    </SfDropDownList>
                                </div>

                                <div/>



                            </div>
                            <div class="row py-1">
                                <div class="col-md-3 d-flex align-items-center">
                                    <i class="fa-solid fa-clock fa-lg" style="color: dimgray"></i>&nbsp;&nbsp;<span style="color: dimgray;"><b>Срок</b></span> &nbsp;&nbsp;&nbsp;&nbsp;
                                </div>
                                <div class="col-md-9 d-flex align-items-center">
                                    <SfDateRangePicker ID="datepicker" TValue="DateTime" Format="dd.MM.yyyy" @bind-StartDate="@issue.StartTime" @bind-EndDate="@issue.EndTime" ShowTodayButton="true" ShowClearButton="true" Min="@MinDate"></SfDateRangePicker>
                                    <ValidationMessage For="@(() => issue.EndTime)"/>
                                    <ValidationMessage For="@(() => issue.StartTime)"/>
                                </div>
                            </div>
                        </div>
                        <ValidationMessage For="@(() => issue.Project)"/>
                    </div>
                </div>
                <label for="description">Описание на задача</label>
                <div class="multiline">
                    <SfTextBox id="description" Multiline=true Placeholder="Въведете описание на задача" @bind-Value="@issue.Description"></SfTextBox>
                    <ValidationMessage For="@(() => issue.Description)"/>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="owner">Възложена на</label>
                        <SfDropDownList ID="owner" TValue="ApplicationUser" TItem="ApplicationUser" @bind-Value="issue.AssignedТo" PopupHeight="350px" PopupWidth="350px" Placeholder="Изберете, на кого е възложена" DataSource="@users">
                            <DropDownListFieldSettings Value="UserName" Text="FullName"></DropDownListFieldSettings>
                        </SfDropDownList>
                        @*<SfDropDownList ID="owner" TValue="string" TItem="ApplicationUser" @bind-Value="issueAssignedToUserName" PopupHeight="350px" PopupWidth="350px" Placeholder="Изберете, на кого е възложена " DataSource="@users">
                            <DropDownListFieldSettings Value="UserName" Text="FullName"></DropDownListFieldSettings>
                        </SfDropDownList>*@
                        <ValidationMessage For="@(() => issue.AssignedТo)"/>
                    </div>

                </div>


            </EditForm>
        </Content>
        <FooterTemplate>
            <div class="form-group">
                <div class="text-right">
                    <button type="button" class="btn btn-primary" @onclick="SaveIssue">Запиши</button>
                    <button type="button" class="btn btn-secondary" @onclick="CloseDialog">Отказ</button>
                </div>
            </div>
        </FooterTemplate>
    </DialogTemplates>
</SfDialog>
<ToastMsg @ref="toast" />

<style>
    .e-dialog .e-dlg-content {
        font-family: SegoeUI;
    }
</style>